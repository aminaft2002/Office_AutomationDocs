### 🧾 Use Case: `RevokeUserRole`

**(لغو یا حذف نقش از کاربر توسط مدیر یا مسئول نقش‌ها)**

|ویژگی|توضیح|
|---|---|
|**هدف (Goal)**|محدودسازی دسترسی کاربر با حذف نقش غیرمجاز یا تغییر یافته|
|**نقش‌های مجاز (Actors)**||

- `Admin` (مدیر سامانه)
    
- `RoleManager` (مدیر نقش‌ها - در صورت وجود) |  
    | **پیش‌شرط‌ها (Preconditions)** |
    
- کاربر مورد نظر قبلاً دارای نقش باشد
    
- نقش مورد نظر در لیست نقش‌های فعال کاربر ثبت شده باشد
    
- مجری دارای دسترسی لازم برای لغو نقش باشد |  
    | **پس‌شرط‌ها (Postconditions)** |
    
- نقش مشخص‌شده از کاربر حذف می‌شود
    
- دسترسی‌های مرتبط با نقش حذف‌شده دیگر برای کاربر فعال نخواهد بود
    
- یک لاگ برای پیگیری ثبت می‌شود |
    

---

### 🔁 جریان اصلی (Main Flow)

1. مدیر وارد پنل کاربران می‌شود
    
2. کاربر هدف را جستجو کرده و پروفایل او را باز می‌کند
    
3. وارد بخش "نقش‌های کاربر" می‌شود
    
4. نقش مورد نظر را انتخاب کرده و گزینه "لغو نقش" را انتخاب می‌کند
    
5. سیستم درخواست را تأیید کرده و ارتباط `UserRole` را حذف می‌کند
    
6. پیام موفقیت نمایش داده می‌شود
    
7. لاگ مدیریتی ثبت می‌گردد
    

---

### 🔄 جریان جایگزین (Alternate Flows)

- اگر نقش مورد نظر قبلاً حذف شده باشد، پیام مناسب نمایش داده می‌شود
    
- اگر کاربر هیچ نقشی نداشته باشد، گزینه لغو فعال نمی‌شود
    

---

### ❗ استثناها (Exceptions)

- کاربر یا نقش وجود نداشته باشد (خطای هم‌زمانی)
    
- خطای دسترسی هنگام اجرای عملیات
    
- خطای پایگاه داده هنگام حذف رکورد
    

---

### 🧩 الزامات فنی (Technical Requirements)

- جدول واسط: `UserRoles` → عملیات حذف سطر بر اساس `UserId` و `RoleId`
    
- ثبت اطلاعات `RevokedBy` و `RevokedAt` در لاگ جداگانه (اختیاری)
    
- بررسی اینکه حداقل یک مدیر باقی بماند (در صورت حذف نقش Admin از آخرین مدیر)
    

---

### 🔒 ملاحظات امنیتی (Security Notes)

- فقط کاربران با مجوز `RoleManagement` مجاز به حذف نقش‌ها هستند
    
- حذف نقش `Admin` فقط توسط کاربران با سطح بالاتر (مثلاً `SuperAdmin`) مجاز است
    
- بررسی CSRF و تایید دو مرحله‌ای برای نقش‌های حساس (اختیاری)