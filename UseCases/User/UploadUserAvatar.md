
### 🧾 Use Case: `UploadUserAvatar`

**(بارگذاری یا تغییر تصویر نمایه کاربر)**

|ویژگی|توضیح|
|---|---|
|**هدف (Goal)**|بارگذاری یا به‌روزرسانی تصویر نمایه (آواتار) کاربر در پروفایل|
|**نقش‌های مجاز (Actors)**||

- `User` (برای خودش)
    
- `Admin` (برای دیگران) |  
    | **پیش‌شرط‌ها (Preconditions)** |
    
- کاربر باید احراز هویت شده باشد
    
- فایل تصویر باید یکی از فرمت‌های مجاز باشد (`jpg`, `png`, `webp`, ...)
    
- حجم فایل باید زیر حد مجاز (مثلاً ۲MB) باشد |  
    | **پس‌شرط‌ها (Postconditions)** |
    
- تصویر آواتار در سرور آپلود شده و به کاربر تخصیص داده می‌شود
    
- آدرس فایل ذخیره می‌شود در فیلد `AvatarUrl`
    

---

### 🔁 جریان اصلی (Main Flow)

1. کاربر وارد بخش ویرایش پروفایل می‌شود
    
2. دکمه "تغییر تصویر پروفایل" را انتخاب می‌کند
    
3. یک فایل تصویری از سیستم انتخاب و ارسال می‌کند
    
4. سیستم تصویر را اعتبارسنجی و سپس در فضای فایل ذخیره می‌کند
    
5. لینک تصویر در پروفایل کاربر ثبت می‌شود
    
6. پیام "تصویر با موفقیت بارگذاری شد" نمایش داده می‌شود
    

---

### 🛠️ پیاده‌سازی فنی

|ویژگی|مقدار|
|---|---|
|مدل|فیلد `AvatarUrl: string?` در `User`|
|ذخیره‌سازی|فایل در مسیر `wwwroot/uploads/avatars/{userId}.jpg` یا فضای ابری|
|اعتبارسنجی|بررسی MIME type و حجم فایل|
|امنیت||

- محدودیت اندازه و نوع فایل
    
- بررسی فایل‌های جعلی
    
- حذف تصویر قبلی (در صورت وجود) |
    

---

### 🔄 جریان جایگزین (Alternate Flows)

- فایل نامعتبر → نمایش پیام خطای "فرمت یا حجم فایل نامعتبر است"
    
- کاربر بدون مجوز کافی → پیام خطای "شما اجازه انجام این عملیات را ندارید"
    
- خطای سرور هنگام ذخیره → نمایش پیام خطای عمومی
    

---

### ✅ خروجی

- فیلد `AvatarUrl` در پروفایل کاربر به‌روزرسانی می‌شود
    
- رابط کاربری تصویر جدید را نمایش می‌دهد