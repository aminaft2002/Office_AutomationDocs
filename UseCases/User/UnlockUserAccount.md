
### 🧾 Use Case: `UnlockUserAccount`

**(باز کردن قفل حساب یک کاربر برای اجازه ورود مجدد به سیستم)**

|ویژگی|توضیح|
|---|---|
|**هدف (Goal)**|فعال‌سازی مجدد دسترسی کاربر به سیستم پس از قفل شدن|
|**نقش‌های مجاز (Actors)**||

- `Admin`
    
- `SecurityManager`
    
- `UserManager` |  
    | **پیش‌شرط‌ها (Preconditions)** |
    
- کاربر موردنظر باید وجود داشته باشد
    
- حساب کاربر باید در حالت قفل‌شده باشد (`IsLocked == true`)
    
- مدیر باید دارای مجوز `UnlockUserPermission` باشد |  
    | **پس‌شرط‌ها (Postconditions)** |
    
- حساب کاربر باز شده و اجازه ورود به سیستم خواهد داشت |
    

---

### 🔁 جریان اصلی (Main Flow)

1. مدیر وارد پنل مدیریت کاربران می‌شود
    
2. کاربر قفل‌شده را از لیست انتخاب می‌کند
    
3. روی دکمه "باز کردن حساب" کلیک می‌کند
    
4. سیستم فیلد `IsLocked` را به `false` یا `LockedAt = null` تغییر می‌دهد
    
5. پیام موفقیت‌آمیز نمایش داده می‌شود
    

---

### 🔐 پیاده‌سازی فنی (Domain & Infrastructure)

|ویژگی|مقدار|
|---|---|
|فیلد در دیتابیس|`IsLocked: bool` یا `LockedAt: DateTime?`|
|درگاه امنیتی|بررسی عدم قفل بودن حساب هنگام ورود|
|ثبت فعالیت|ایجاد لاگ امنیتی `UserUnlocked` همراه با مشخصات مدیر و زمان عملیات|

---

### 🔄 جریان جایگزین (Alternate Flows)

- اگر حساب از قبل باز باشد → پیام "حساب قبلاً فعال است"
    
- اگر کاربر مجاز به انجام این کار نباشد → پیام خطای مجوز
    
- اگر کاربر هدف وجود نداشته باشد → پیام "کاربر یافت نشد"
    

---

### ❗ استثناها (Exceptions)

- اختلال در پایگاه داده هنگام باز کردن قفل
    
- تلاش برای باز کردن قفل حساب یک مدیر ارشد بدون مجوز مناسب
    

---

### ✅ خروجی

- پیام موفقیت یا خطا
    
- به‌روزرسانی در وضعیت حساب کاربری