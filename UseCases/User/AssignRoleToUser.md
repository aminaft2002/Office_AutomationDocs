
### 🧾 Use Case: `AssignRoleToUser`

**(اختصاص نقش به یک کاربر توسط مدیر سامانه)**

|ویژگی|توضیح|
|---|---|
|**هدف (Goal)**|مدیریت دسترسی‌ها با اختصاص نقش مناسب به کاربران|
|**نقش‌های مجاز (Actors)**||

- `Admin` (مدیر سامانه)
    
- `RoleManager` (مدیر نقش‌ها - در صورت وجود) |  
    | **پیش‌شرط‌ها (Preconditions)** |
    
- کاربر هدف قبلاً در سیستم ثبت شده باشد
    
- نقش مورد نظر از قبل تعریف شده باشد
    
- مجری عملیات دسترسی لازم برای تخصیص نقش داشته باشد |  
    | **پس‌شرط‌ها (Postconditions)** |
    
- نقش انتخاب‌شده به کاربر اختصاص می‌یابد
    
- کاربر پس از لاگین مجدد یا ریفرش، مجوزهای مرتبط با نقش را دریافت می‌کند
    
- لاگ ثبت می‌شود |
    

---

### 🔁 جریان اصلی (Main Flow)

1. مدیر وارد پنل مدیریت کاربران می‌شود
    
2. کاربر مورد نظر را انتخاب می‌کند
    
3. گزینه "اختصاص نقش" را کلیک می‌کند
    
4. لیستی از نقش‌های موجود نمایش داده می‌شود
    
5. یک یا چند نقش انتخاب و تأیید می‌شود
    
6. سیستم نقش‌ها را به کاربر اختصاص می‌دهد
    
7. پیام موفقیت نمایش داده شده و لاگ ثبت می‌شود
    

---

### 🔄 جریان جایگزین (Alternate Flows)

- اگر نقش قبلاً به کاربر اختصاص داده شده باشد، پیام هشدار نمایش داده می‌شود
    
- در صورت انتخاب کاربر یا نقش نامعتبر، عملیات لغو می‌شود
    

---

### ❗ استثناها (Exceptions)

- نقش انتخاب‌شده وجود ندارد (حذف شده باشد)
    
- کاربر موردنظر غیرفعال یا حذف شده باشد
    
- خطای سرور هنگام ذخیره‌سازی ارتباط نقش و کاربر
    

---

### 🧩 الزامات فنی (Technical Requirements)

- جدول واسط: `UserRoles` با فیلدهای `UserId`, `RoleId`, `AssignedBy`, `AssignedAt`
    
- بررسی عدم تکرار نقش (عدم ثبت مجدد یک نقش تکراری)
    
- پشتیبانی از چند نقش هم‌زمان برای هر کاربر
    
- ثبت لاگ مدیریتی با اطلاعات کامل
    

---

### 🔒 ملاحظات امنیتی (Security Notes)

- فقط مدیران مجاز می‌توانند نقش اختصاص دهند
    
- بررسی دسترسی مجری قبل از اجرای عملیات
    
- بررسی صحت اطلاعات ورودی (مثلاً `RoleId` معتبر باشد)