



### بازگردانی نامه از حالت آرشیو به وضعیت فعال

---

### 🎯 هدف:

کاربر بتواند نامه‌ای را که قبلاً به حالت آرشیو منتقل شده، مجدداً به لیست نامه‌های فعال بازگرداند (Restore).

---

### ✅ سناریوهای کاربردی

|سناریو|توضیح|
|---|---|
|بازگردانی اشتباهی که نامه آرشیو شده|جهت ویرایش یا بررسی بیشتر|
|بازگردانی نامه برای پیگیری مجدد|زمانی که هنوز نیاز به اقدام است|

---

### 📥 ورودی‌ها (Input)

|فیلد|نوع|الزامی؟|توضیح|
|---|---|---|---|
|`LetterId`|`Guid`|✅|شناسه نامه‌ای که باید بازگردانی شود|
|`RequesterUserId`|`Guid`|✅|کاربر انجام‌دهنده عملیات|

---

### ⚙️ مراحل اجرا

1. **بررسی اعتبار**:
    
    - آیا کاربر دسترسی بازگردانی دارد؟
        
    - آیا نامه واقعاً در وضعیت Archived است؟
        
2. **تغییر وضعیت**:
    
    - تغییر `Status` از `Archived` به آخرین وضعیت قبلی (مثلاً `InProgress` یا `Sent`)
        
    - یا: وضعیت به `Restored` تغییر داده شود (در صورت نیاز به پیگیری)
        
3. **ثبت لاگ اقدام**:
    
    - درج در `LetterLog` با نوع اقدام `Unarchive`
        
4. **اعلان به کاربران مرتبط (اختیاری)**:
    
    - در صورت بازگردانی توسط مدیر یا کاربر خاص، می‌توان اطلاع‌رسانی کرد
        

---

### 📤 خروجی (Output)

|فیلد|نوع|توضیح|
|---|---|---|
|`Success`|`bool`|آیا عملیات موفق بود؟|
|`PreviousStatus`|`enum`|وضعیت قبلی نامه|
|`CurrentStatus`|`enum`|وضعیت جدید (فعال شده)|
|`Message`|`string`|پیام بازخورد مناسب برای UI|

---

### 📎 نکات مهم

- اگر نامه‌ای از حالت آرشیو خارج شود، در نتایج جستجوی فعال دوباره دیده می‌شود.
    
- این عمل نباید برای نامه‌های نهایی‌شده و بایگانی رسمی (مثلاً با امضای دیجیتال و پرونده بسته‌شده) قابل اجرا باشد مگر توسط مدیر سیستم.
    
- در سیستم باید مشخص باشد که این بازگردانی یک اقدام مهم است و باید در لاگ‌های نظارتی ذخیره شود.