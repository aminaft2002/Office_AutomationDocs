
### فیلتر کردن نامه‌ها بر اساس تگ (برچسب) خاص

---

### 🎯 هدف:

نمایش لیست نامه‌هایی که دارای یک یا چند **تگ مشخص** هستند و کاربر به مشاهده آن‌ها دسترسی دارد.

---

### ✅ سناریوهای کاربردی

|سناریو|توضیح|
|---|---|
|نمایش نامه‌های مربوط به پروژه خاص|مثلاً همه نامه‌هایی که تگ "پروژه X" دارند|
|فیلتر نامه‌های ارجاع‌شده به واحد خاص با تگ "فوری"|ترکیب وضعیت و تگ|
|بررسی نامه‌های محرمانه دارای برچسب خاص|با رعایت سطح دسترسی|

---

### 📥 ورودی‌ها (Input)

|فیلد|نوع|الزامی؟|توضیح|
|---|---|---|---|
|`TagIds`|`List<Guid>`|✅|لیست شناسه‌های تگ برای فیلتر|
|`UserId`|`Guid`|✅|برای اعمال سطح دسترسی|
|`Status`|`LetterStatus?`|❌|فیلتر بر اساس وضعیت نامه|
|`SenderUnitId`|`Guid?`|❌|فیلتر واحد فرستنده|
|`Priority`|`LetterPriority?`|❌|فیلتر بر اساس اولویت|
|`DateFrom`|`DateTime?`|❌|تاریخ شروع|
|`DateTo`|`DateTime?`|❌|تاریخ پایان|
|`PageIndex`|`int`|✅|صفحه فعلی|
|`PageSize`|`int`|✅|تعداد آیتم در هر صفحه|

---

### ⚙️ مراحل اجرا

1. بررسی دسترسی کاربر به نامه‌ها (محرمانگی و مجوزها)
    
2. اتصال به جدول واسط `LetterTag` برای پیدا کردن نامه‌هایی که حداقل یکی از تگ‌ها را دارند
    
3. اعمال فیلترهای دیگر (وضعیت، تاریخ، واحد و...)
    
4. بازگرداندن نتایج صفحه‌بندی‌شده
    

---

### 📤 خروجی (Output)

|فیلد|نوع|توضیح|
|---|---|---|
|`TotalCount`|`int`|تعداد کل نتایج|
|`Letters`|`List<LetterSummaryDto>`|لیست خلاصه نامه‌ها|
|`PageIndex`|`int`|صفحه فعلی|
|`PageSize`|`int`|اندازه صفحه|

---

### 📄 مدل `LetterSummaryDto`

همان مدل استفاده‌شده در `SearchLetters`.

---

### 🔒 نکات امنیتی

- فقط نامه‌هایی نمایش داده می‌شوند که کاربر مجوز دیدن آن‌ها را دارد (از طریق LetterPermission، نقش، واحد و ...).
    
- در صورت وجود نامه‌های محرمانه با تگ مشترک، ابتدا سطح دسترسی بررسی می‌شود.