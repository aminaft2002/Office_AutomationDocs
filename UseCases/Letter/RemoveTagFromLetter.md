### 🎯 هدف:

حذف یک برچسب (Tag) خاص از یک نامه.

---

### 🧩 پیش‌نیازها:

|شرط|توضیح|
|---|---|
|نامه باید وجود داشته باشد|بررسی `LetterId`|
|برچسب باید وجود داشته باشد|بررسی `TagId`|
|ارتباط بین نامه و برچسب باید وجود داشته باشد|بررسی `LetterTag`|
|کاربر باید اجازه ویرایش یا مدیریت برچسب‌های نامه را داشته باشد|بررسی از `LetterPermission`|
|نامه نباید نهایی شده باشد|`IsFinalized == false`|

---

### 📥 ورودی‌ها (Input)

|فیلد|نوع|الزامی؟|توضیح|
|---|---|---|---|
|`LetterId`|`Guid`|✅|شناسه نامه|
|`TagId`|`Guid`|✅|شناسه برچسب برای حذف|
|`RequestedByUserId`|`Guid`|✅|شناسه کاربری که درخواست حذف داده|

---

### ⚙️ مراحل اجرایی

1. بررسی وجود نامه با `LetterId`
    
2. بررسی `IsFinalized == false`
    
3. بررسی وجود برچسب با `TagId`
    
4. بررسی وجود رکورد `LetterTag` برای این نامه و این برچسب
    
5. بررسی مجوز ویرایش یا حذف برچسب برای کاربر
    
6. حذف رکورد `LetterTag` مربوطه
    
7. (اختیاری) ثبت لاگ در `LetterLog` با نوع عملیات `TagRemoved`
    

---

### 📤 خروجی (Output)

|فیلد|نوع|توضیح|
|---|---|---|
|`Success`|`bool`|موفقیت عملیات|
|`Errors`|`List<string>`|لیست خطاهای احتمالی|

---

### 🛡️ کنترل‌های امنیتی

- فقط کاربران دارای مجوز `ManageTags` یا `EditLetter` برای آن نامه می‌توانند برچسب حذف کنند.
    
- نامه‌هایی که نهایی شده‌اند، نمی‌توانند برچسب‌هایشان تغییر کنند.
    

---

### 🔄 ارتباط با مدل‌ها

- `Letter`
    
- `Tag`
    
- `LetterTag`
    
- `LetterPermission`
    
- `LetterLog` (اختیاری)