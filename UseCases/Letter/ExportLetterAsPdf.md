
### خروجی گرفتن از یک نامه به‌صورت فایل PDF

---

### 🎯 هدف:

کاربر بتواند یک نامه را با محتوای کامل، فراداده (متادیتا) و پیوست‌ها (در صورت نیاز) به‌صورت فایل PDF خروجی بگیرد.

---

### ✅ سناریوهای کاربردی

|سناریو|توضیح|
|---|---|
|تهیه نسخه PDF برای چاپ فیزیکی|با فرمت رسمی و لوگو|
|ارسال فایل PDF نامه به سازمان بیرونی|برای نامه‌های صادره|
|ذخیره‌سازی نسخه آرشیوی از نامه|به‌همراه امضا یا شماره نامه رسمی|

---

### 📥 ورودی‌ها (Input)

|فیلد|نوع|الزامی؟|توضیح|
|---|---|---|---|
|`LetterId`|`Guid`|✅|شناسه نامه موردنظر|
|`IncludeAttachments`|`bool`|❌|آیا پیوست‌ها نیز در PDF درج شوند؟ (افزودن لینک یا الصاق)|
|`ExportMode`|`enum`|❌|حالت خروجی: رسمی، پیش‌نویس، فقط محتوا، همراه لوگو|
|`RequestedByUserId`|`Guid`|✅|برای لاگ و بررسی سطح دسترسی|

csharp

CopyEdit

`enum ExportMode {   OfficialWithLogo,   DraftWithoutLogo,   ContentOnly }`

---

### ⚙️ مراحل اجرا

1. اعتبارسنجی `LetterId` و بررسی سطح دسترسی کاربر
    
2. دریافت داده‌های کامل نامه از دیتابیس:
    
    - محتوا
        
    - اطلاعات فرستنده/گیرنده
        
    - تاریخ و شماره رسمی
        
    - پیوست‌ها (در صورت نیاز)
        
3. ساخت فایل PDF:
    
    - استفاده از تمپلیت رسمی PDF
        
    - اضافه‌کردن واترمارک، لوگو یا سربرگ (بر اساس ExportMode)
        
    - درج اطلاعات متادیتا
        
4. بازگرداندن لینک امن یا فایل خروجی PDF
    

---

### 📤 خروجی (Output)

|فیلد|نوع|توضیح|
|---|---|---|
|`FileName`|`string`|نام فایل تولید شده|
|`DownloadUrl`|`string`|لینک موقت برای دریافت PDF|
|`GeneratedAt`|`DateTime`|زمان تولید خروجی|

---

### 📎 نکات مهم

- پیاده‌سازی PDF می‌تواند از ابزارهایی مانند `iTextSharp`، `QuestPDF` یا `DinkToPdf` استفاده کند.
    
- قالب PDF باید قابلیت سفارشی‌سازی داشته باشد (فونت فارسی، قالب نامه رسمی، تاریخ شمسی)
    
- اگر نامه نهایی نشده باشد (`IsFinalized == false`)، در PDF برچسب پیش‌نویس درج شود.
    
- سطح دسترسی بررسی شود (برای نامه‌های محرمانه یا داخلی)