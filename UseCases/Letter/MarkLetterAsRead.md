
### 🎯 هدف:

علامت‌گذاری یک نامه به‌عنوان خوانده‌شده توسط یک کاربر، به‌منظور:

- تغییر وضعیت در UI
    
- ثبت در تاریخچه مشاهده (برای بررسی‌های بعدی یا آمار)
    
- جلوگیری از ارسال اعلان تکراری
    

---

### ✅ سناریوهای کاربردی

|سناریو|توضیح|
|---|---|
|کاربر نامه را باز می‌کند|سیستم به‌صورت خودکار نامه را "خوانده‌شده" علامت می‌زند|
|از API مشاهده استفاده می‌شود|با کلیک یا نمایش جزئیات، وضعیت تغییر می‌کند|
|یک نامه توسط چند نفر مشاهده می‌شود|سیستم فقط برای مشاهده‌کننده جاری ثبت می‌کند|

---

### 📥 ورودی‌ها (Input)

|فیلد|نوع|الزامی؟|توضیح|
|---|---|---|---|
|`LetterId`|`Guid`|✅|شناسه نامه|
|`UserId`|`Guid`|✅|شناسه کاربری که مشاهده کرده|
|`ViewedAt`|`DateTime?`|❌|در صورت عدم ارسال، زمان فعلی ثبت می‌شود|

---

### ⚙️ مراحل اجرا

1. بررسی اینکه آیا رکورد `LetterViewHistory` قبلاً برای این کاربر و نامه وجود دارد؟
    
2. اگر وجود ندارد → ثبت جدید
    
3. اگر وجود دارد → به‌روزرسانی `ViewedAt` در صورت نیاز (یا صرف‌نظر، بسته به سیاست سیستم)
    
4. علامت‌گذاری نامه به‌عنوان خوانده‌شده در UI (مثلاً در کش یا پاسخ API)
    

---

### 📤 خروجی (Output)

|فیلد|نوع|توضیح|
|---|---|---|
|`Success`|`bool`|نتیجه عملیات|
|`AlreadyRead`|`bool`|اگر قبلاً خوانده‌شده بوده|
|`ViewedAt`|`DateTime`|زمان ثبت‌شده به‌عنوان زمان مشاهده|

---

### 🧱 مدل `LetterViewHistory`

|فیلد|نوع|توضیح|
|---|---|---|
|`Id`|`Guid`|شناسه یکتا|
|`LetterId`|`Guid`|نامه مربوطه|
|`UserId`|`Guid`|کاربری که نامه را دیده|
|`ViewedAt`|`DateTime`|زمان مشاهده|

> این مدل در دامین هم طراحی شد و آماده استفاده است.

---

### 🔒 نکات مهم:

- این یوزکیس برای تحلیل رفتار کاربر، امنیت، و مدیریت اعلان‌ها اهمیت بالایی دارد.
    
- می‌توان از این اطلاعات برای آمار کلی، بررسی اثربخشی نامه‌ها، یا حتی پیگیری کارها استفاده کرد.