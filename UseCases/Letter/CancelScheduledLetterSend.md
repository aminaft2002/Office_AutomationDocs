### ✅ اطلاعات پایه

|ویژگی|مقدار|
|---|---|
|🎯 نام یوزکیس|CancelScheduledLetterSend|
|🧩 دامنه مرتبط|Letter|
|🎯 هدف|لغو ارسال زمان‌بندی‌شده نامه‌ای که هنوز ارسال نشده|
|📦 نقش استفاده‌کننده|نویسنده نامه، مدیر سیستم، یا کاربر دارای دسترسی خاص|
|📅 وضعیت اجرا|فقط قبل از موعد ارسال قابل اجراست|
|🔐 مجوز مورد نیاز|CanScheduleLetterSend + CanCancelScheduledSend|

---

### 📝 توضیح کلی

کاربر می‌تواند ارسال نامه‌ای که برای آینده زمان‌بندی شده را قبل از رسیدن زمان مقرر، لغو کند تا نامه در همان حالت پیش‌نویس باقی بماند یا حذف شود.

---

### ✅ ورودی‌ها

|ورودی|نوع|توضیح|
|---|---|---|
|`LetterId`|`Guid`|شناسه نامه‌ای که ارسال آن زمان‌بندی شده|
|`Reason` _(اختیاری)_|`string`|دلیل لغو (برای لاگ یا توضیح داخلی)|
|`UserId`|`Guid`|شناسه کاربری که درخواست لغو داده|

---

### 🎯 خروجی

|خروجی|نوع|توضیح|
|---|---|---|
|`Success`|`bool`|نتیجه لغو (موفق یا ناموفق)|
|`Message`|`string`|پیام مناسب برای کاربر یا لاگ|
|`UpdatedLetterStatus`|`LetterStatus`|وضعیت جدید نامه (Draft یا ScheduledCancelled)|

---

### 🧠 شرط‌ها و قوانین

- فقط نامه‌هایی که وضعیت `ScheduledToSend` دارند قابل لغو هستند.
    
- اگر نامه پیش از زمان ارسال دستی ارسال شده باشد، دیگر قابل لغو نیست.
    
- در صورت لغو، یک لاگ جدید در `LetterLog` ثبت می‌شود.
    
- در UI، این عملیات با یک پیام هشدار همراه است.
    

---

### 🔗 ارتباط با سایر یوزکیس‌ها

- ✅ وابسته به: `ScheduleLetterForSend`
    
- ✅ مکمل با: `SendLetter`, `LogLetterAction`
    
- ❌ غیرمجاز پس از: `FinalizeLetter`, `SendLetter`