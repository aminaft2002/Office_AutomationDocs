
### 🎯 هدف:

حذف یک فایل پیوست از نامه‌ای خاص، در صورتی که نامه هنوز Finalized نشده باشد.

---

### 🧩 پیش‌نیازها:

|شرط|توضیح|
|---|---|
|نامه باید وجود داشته باشد|`LetterId` معتبر باشد|
|نامه نباید نهایی (Finalized) شده باشد|`IsFinalized == false`|
|کاربر باید دسترسی حذف پیوست داشته باشد|بررسی از `LetterPermission`|
|پیوست باید به این نامه متعلق باشد|بررسی `Attachment.LetterId == LetterId`|

---

### 📥 ورودی‌ها (Input)

|فیلد|نوع|الزامی؟|توضیح|
|---|---|---|---|
|`LetterId`|`Guid`|✅|شناسه نامه|
|`AttachmentId`|`Guid`|✅|شناسه پیوست برای حذف|
|`RequestedByUserId`|`Guid`|✅|کاربر درخواست‌دهنده حذف|

---

### ⚙️ مراحل اجرایی

1. بررسی وجود نامه با `LetterId`
    
2. بررسی `IsFinalized == false`
    
3. بررسی وجود پیوست و تعلق آن به نامه
    
4. بررسی مجوز کاربر برای حذف پیوست (`LetterPermission: DeleteAttachment`)
    
5. حذف رکورد `LetterAttachment`
    
6. (اختیاری) حذف فایل فیزیکی از فضای ذخیره‌سازی
    
7. ثبت در `LetterLog`
    

---

### 📤 خروجی (Output)

|فیلد|نوع|توضیح|
|---|---|---|
|`Success`|`bool`|موفقیت عملیات|
|`Errors`|`List<string>`|لیست خطاهای احتمالی|

---

### 🛡️ کنترل‌های امنیتی

- فقط کاربران دارای مجوز `DeleteAttachment` برای آن نامه می‌توانند پیوست حذف کنند.
    
- حذف پیوست از نامه Finalized شده مجاز نیست.
    

---

### 🔄 ارتباط با مدل‌ها

- `Letter`
    
- `LetterAttachment`
    
- `LetterPermission`
    
- (اختیاری) `LetterLog`
    
- (اختیاری) ماژول فایل