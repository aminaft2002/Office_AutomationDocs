### ๐ฏ ูุฏู:

ฺฉุงุฑุจุฑ ุจุชูุงูุฏ ุฏุฑ ูพุงุณุฎ ุจู ฺฉ ูุงูู ุฏุฑุงูุชุ ูุงููโุง ุฌุฏุฏ ุงุฌุงุฏ ฺฉูุฏ ฺฉู ุจูโุนููุงู ูพุงุณุฎ ุซุจุช ุดูุฏ. ุงู ูุงูู ุจุงุฏ ุดุงูู ููฺฉ ุจู ูุงูู ุงุตูุ ู ููฺูู ุงุทูุงุนุงุช ุงุฑุณุงู ุฌุฏุฏ ุจุงุดุฏ.

---

### ๐งฉ ูพุดโูุงุฒูุง:

|ุดุฑุท|ุชูุถุญ|
|---|---|
|ูุงูู ุงุตู ุจุงุฏ ููุฌูุฏ ุจุงุดุฏ|ุจุฑุฑุณ ูุฌูุฏ `OriginalLetterId`|
|ฺฉุงุฑุจุฑ ุจุงุฏ ุงุฌุงุฒู ูพุงุณุฎโุฏู ุฏุงุดุชู ุจุงุดุฏ|ุจุฑุฑุณ `LetterPermission`|
|ูุงูู ุงุตู ุจุงุฏ ูุงุจูุช ูพุงุณุฎโูพุฐุฑ ุฏุงุดุชู ุจุงุดุฏ|ูุซู ูุจูุฏู ุฏุฑ ูุถุนุช ุจุณุชู ุง ุจุฏูู ูุฌูุฒ ูพุงุณุฎ|

---

### ๐ฅ ูุฑูุฏโูุง (Input)

|ููุฏ|ููุน|ุงูุฒุงูุ|ุชูุถุญ|
|---|---|---|---|
|`OriginalLetterId`|`Guid`|โ|ุดูุงุณู ูุงููโุง ฺฉู ุจุงุฏ ูพุงุณุฎ ุฏุงุฏู ุดูุฏ|
|`SenderUserId`|`Guid`|โ|ฺฉุงุฑุจุฑ ูพุงุณุฎโุฏููุฏู|
|`SenderUnitId`|`Guid?`|โ|ูุงุญุฏ ูุฑุณุชูุฏู (ุฏุฑ ุตูุฑุช ูุงุฒ)|
|`Subject`|`string`|โ|ููุถูุน ูุงูู ูพุงุณุฎ|
|`Body`|`string`|โ|ูุชู ูุงูู ูพุงุณุฎ|
|`Priority`|`enum`|โ|ุงูููุช ูุงูู|
|`Confidentiality`|`enum`|โ|ูุญุฑูุงูฺฏ|
|`Attachments`|`List<File>`|โ|ูุงูโูุง ูพูุณุช|
|`ReceiverUserId` ุง `ReceiverUnitId`|`Guid`|โ|ฺฏุฑูุฏู ูพุงุณุฎ|
|`PermissionType`|`LetterPermissionType`|โ|ููุน ุฏุณุชุฑุณ ุจุฑุง ฺฏุฑูุฏู|
|`ForwardType`|`enum`|โ|ูพุงุณุฎ ุฌูุช ุงูุฏุงู ุง ุงุทูุงุน|

---

### โ๏ธ ูุฑุงุญู ุงุฌุฑุง

1. ุจุฑุฑุณ ูุฌูุฏ `OriginalLetterId` ุฏุฑ ุณุณุชู
    
2. ุจุฑุฑุณ ูุฌูุฒ ูพุงุณุฎโุฏู ุชูุณุท `SenderUserId`
    
3. ุงุฌุงุฏ ูุงูู ุฌุฏุฏ (`Letter`) ุจุง ูพุฑ ุดุฏู ููุฏ `ResponseToLetterId = OriginalLetterId`
    
4. ฺฉูพ ุจุฑุฎ ูฺฺฏโูุง ุงุฒ ูุงูู ุงุตู (ุฏุฑ ุตูุฑุช ุชุนุฑู ุฑูู ูุงููุฏ Subject prefix ุง ุฑูููุดุช)
    
5. ุงุฌุงุฏ ูุณุฑ ุงููู ุฏุฑ `LetterRouting` ุจู ฺฏุฑูุฏู ูพุงุณุฎ
    
6. ุชูุธู ุฏุณุชุฑุณ ุฏุฑ `LetterPermission`
    
7. ุงูุฒูุฏู ูพูุณุชโูุง ุฏุฑ `LetterAttachment` (ุฏุฑ ุตูุฑุช ูุฌูุฏ)
    
8. ุจูโุฑูุฒุฑุณุงู ููุฏ `HasReplies = true` ุฏุฑ ูุงูู ุงุตู
    
9. ุซุจุช ูุงฺฏ ุฌุฏุฏ ุฏุฑ `LetterLog` ุจุง ููุน `Replied`
    

---

### ๐ค ุฎุฑูุฌ (Output)

|ููุฏ|ููุน|ุชูุถุญ|
|---|---|---|
|`NewLetterId`|`Guid`|ุดูุงุณู ูุงูู ูพุงุณุฎโุฏู ุดุฏู|
|`Success`|`bool`|ูุถุนุช ููููุช ุนููุงุช|
|`Errors`|`List<string>`|ูุณุช ุฎุทุงูุง ุฏุฑ ุตูุฑุช ูุฌูุฏ|

---

### ๐ ุงุฑุชุจุงุท ุจุง ูุฏูโูุง

- `Letter` โ ุงุฌุงุฏ ูุงูู ูพุงุณุฎ ุจุง `ResponseToLetterId`
    
- `LetterRouting` โ ูุณุฑ ุงููู ุจุฑุง ุงุฑุณุงู ูพุงุณุฎ
    
- `LetterPermission` โ ุณุทุญ ุฏุณุชุฑุณ ุจุฑุง ฺฏุฑูุฏู ูพุงุณุฎ
    
- `LetterAttachment` โ ูพูุณุชโูุง ุฌุฏุฏ
    
- `LetterLog` โ ุซุจุช ูุงฺฏ ูพุงุณุฎโุฏู
    

---

### ๐ก๏ธ ุงููุช ู ฺฉูุชุฑู ุฏุณุชุฑุณ

- ุจุฑุฑุณ ุงูฺฉู ฺฉุงุฑุจุฑ ุงุฌุงุฒู ูุดุงูุฏู ู ูพุงุณุฎโุฏู ุจู ูุงูู ุงุตู ุฑุง ุฏุงุฑุฏ.
    
- ุจุฑุฑุณ ุงูฺฉู ูุงูู ุงุตู ูุงุจู ูพุงุณุฎ ุจุงุดุฏ (ูุซูุงู ุจุงฺฏุงู ูุดุฏู).
    
- ุฑุนุงุช ูุญุฑูุงูฺฏ ุฏุฑ ูพุงุณุฎ (ูพุงุณุฎ ููโุชูุงูุฏ ูุญุฑูุงูฺฏ ฺฉูุชุฑ ุงุฒ ูุงูู ุงุตู ุฏุงุดุชู ุจุงุดุฏ ูฺฏุฑ ูุฌุงุฒ ุจุงุดุฏ).