

### ๐ Use Case: GenerateLetterNumber

|ูฺฺฏ|ููุฏุงุฑ|
|---|---|
|**ูุงู ูุฒฺฉุณ**|GenerateLetterNumber|
|**ูุฏู**|ุชููุฏ ฺฉ ุดูุงุฑู ฺฉุชุง ุจุฑุง ูุงูู ุจุฑ ุงุณุงุณ ุงูฺฏู ุชุนูโุดุฏูุ ุฌูุช ุฏุฑุฌ ุฏุฑ ููุฏ `LetterNumber`|
|**Actor**|ุณุณุชู (ุงุชููุงุชฺฉ) ุง ฺฉุงุฑุจุฑ ุฏุฑ ููฺฏุงู ููุงโุณุงุฒ ุง ุงุฑุณุงู ูุงูู|
|**Trigger**|ุงุฑุณุงู ูุงูู ุง ุซุจุช ููุง ูพุดโููุณ ุฏุฑ ุณุณุชู ุชูุณุท ฺฉุงุฑุจุฑ ุง ูุฑุขูุฏ ุจฺฉโุงูุฏ|

---

### ๐งฉ Preconditions (ูพุดโูุงุฒูุง):

- ูุงูู ุฏุฑ ูุถุนุช `Draft` ุง ุจุฏูู ุดูุงุฑู ุจุงุดุฏ.
    
- ุงูฺฏู ุดูุงุฑูโฺฏุฐุงุฑ (Template/Pattern) ุงุฒ ูพุด ุชุนู ุดุฏู ุจุงุดุฏ (ูุซูุงู: `YYYY-MM-UnitCode-Sequence`).
    

---

### โ๏ธ Main Flow (ุฑููุฏ ุงุตู):

1. ุณุณุชู ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ูุงูู ุฏุฑ ูุถุนุช ูุฌุงุฒ ุจุฑุง ุดูุงุฑูโฺฏุฐุงุฑ ุงุณุช ุง ุฎุฑ.
    
2. ุงูฺฏู ุดูุงุฑูโฺฏุฐุงุฑ ุงุฒ ุชูุธูุงุช ุณุณุชู ุง ูุงุญุฏ ุณุงุฒูุงู ุงุณุชุฎุฑุงุฌ ูโุดูุฏ.
    
3. ุงุฌุฒุง ุงูฺฏู ูุงููุฏ `ุชุงุฑุฎุ ฺฉุฏ ูุงุญุฏุ ุดูุงุฑูุฏู` ุจุง ููุงุฏุฑ ุฌุงุฑ ุฌุงฺฏุฒู ูโุดููุฏ.
    
4. ฺฉ ุดูุงุฑู ฺฉุชุง ุจุฑ ุงุณุงุณ ุงู ุงูฺฏู ุชููุฏ ูโุดูุฏ:
    
    - ุจุฑุฑุณ ูโุดูุฏ ฺฉู ุงู ุดูุงุฑู ุฏุฑ ุฏุชุงุจุณ ุชฺฉุฑุงุฑ ูุจุงุดุฏ.
        
    - ุฏุฑ ุตูุฑุช ุชฺฉุฑุงุฑุ ุดูุงุฑูุฏู ุงูุฒุงุด ุงูุชู ู ูุฌุฏุฏ ุงูุชุญุงู ูโุดูุฏ.
        
5. ุดูุงุฑู ููุง ุฏุฑ ููุฏ `LetterNumber` ุฐุฎุฑู ูโุดูุฏ.
    
6. ูุถุนุช ูุงูู ุฏุฑ ุตูุฑุช ูุงุฒ ุงุฒ `Draft` ุจู `Registered` ุง `Sent` ุชุบุฑ ูโุงุจุฏ.
    
7. ูุชุฌู ุจู ฺฉุงุฑุจุฑ ุง ูุงฺูู ูุฑุงุฎูุงู ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏ.
    

---

### ๐ Alternative Flow (ุฌุงฺฏุฒู):

|ุดูุงุฑู|ุดุฑุท|ูุชุฌู|
|---|---|---|
|A1|ุงูฺฏู ุดูุงุฑูโฺฏุฐุงุฑ ุชุนุฑู ูุดุฏู|ุฎุทุง `ConfigurationMissingException` ุจุงุฒฺฏุฑุฏุงูุฏู ุดูุฏ|
|A2|ุดูุงุฑูุฏู ุจู ุญุฏุงฺฉุซุฑ ููุฏุงุฑ ูุฌุงุฒ ุฑุณุฏ|ุฎุทุง `SequenceOverflowException` ุตุงุฏุฑ ุดูุฏ|
|A3|ูุงูู ูุจูุงู ุดูุงุฑูโฺฏุฐุงุฑ ุดุฏู ุงุณุช|ุนููุงุช ูุชููู ุดุฏู ู ูพุงู `LetterAlreadyNumbered` ุจุงุฒฺฏุฑุฏุงูุฏู ุดูุฏ|

---

### ๐ฆ Output (ุฎุฑูุฌ):

{
  "letterId": "uuid",
  "letterNumber": "1403-05-HR-0247",
  "status": "Success"
}
### โ๏ธ ฺฏุฒููโูุง ูุงุจู ุชูุธู:

|ฺฏุฒูู|ุชูุถุญ|
|---|---|
|`Pattern`|ุงูฺฏู ุดูุงุฑูโฺฏุฐุงุฑุ ูุซูุงู: `{yyyy}/{mm}/DEP-{sequence:4}`|
|`UnitScoped`|ุขุง ุดูุงุฑูุฏู ูุฎุชุต ูุฑ ูุงุญุฏ ุณุงุฒูุงู ุจุงุดุฏุ|
|`DailyReset`|ุขุง ุดูุงุฑูุฏู ุฏุฑ ูุฑ ุฑูุฒ ุฑุณุช ุดูุฏุ|
|`PreviewMode`|ููุท ูพุดโููุงุด ุดูุงุฑู ุชููุฏุ ุจุฏูู ุฐุฎุฑู ููุง|

---

### ๐ก๏ธ ูฺฉุงุช ุงููุช:

- ููุท ฺฉุงุฑุจุฑุงู ูุฌุงุฒ ุจู ุงุฑุณุงู ุง ููุงโุณุงุฒ ูุงูู ูโุชูุงููุฏ ุดูุงุฑูโฺฏุฐุงุฑ ุงูุฌุงู ุฏููุฏ.
    
- ุณุณุชู ุจุงุฏ ุงุฒ ุชฺฉุฑุงุฑ ูุจูุฏู ุดูุงุฑูโูุง ุจูโุทูุฑ ุฏูู ุฌููฺฏุฑ ฺฉูุฏ (Transaction Safe).
    

---

### ๐ ูุงุจุณุชฺฏโูุง:

- Entity: `Letter`
    
- Table: `LetterNumberSequence` (ุจุฑุง ูพฺฏุฑ ุดูุงุฑูุฏูโูุง)
    
- Setting: `LetterNumberingPattern`, `ResetPolicy`, `ScopedByUnit`

