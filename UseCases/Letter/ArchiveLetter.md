



### 🎯 هدف:

کاربر بتواند یک نامه را در بخش بایگانی شخصی خود قرار دهد تا از لیست نامه‌های فعال حذف شود اما همچنان قابل دسترسی باشد. این بایگانی برای نظم شخصی است و تأثیری بر وضعیت کلی نامه ندارد.

---

### 🧩 پیش‌نیازها:

|شرط|توضیح|
|---|---|
|نامه باید وجود داشته باشد|بررسی `LetterId` در دیتابیس|
|کاربر باید گیرنده نامه باشد|یا دسترسی مشاهده نامه را داشته باشد|
|نامه نباید قبلاً توسط همین کاربر بایگانی شده باشد|بررسی در `LetterArchive` یا فیلد مرتبط|

---

### 📥 ورودی‌ها (Input)

|فیلد|نوع|الزامی؟|توضیح|
|---|---|---|---|
|`LetterId`|`Guid`|✅|شناسه نامه‌ای که باید بایگانی شود|
|`UserId`|`Guid`|✅|شناسه کاربر جاری|

---

### ⚙️ مراحل اجرایی

1. بررسی وجود نامه با `LetterId`
    
2. بررسی مالکیت یا دسترسی کاربر به نامه
    
3. بررسی عدم وجود بایگانی قبلی برای همان کاربر
    
4. ذخیره رکورد جدید در جدول `LetterArchive` شامل:
    
    - `LetterId`
        
    - `UserId`
        
    - `ArchivedAt`
        
5. بازگرداندن پیام موفقیت یا خطا
    

---

### 📤 خروجی (Output)

|فیلد|نوع|توضیح|
|---|---|---|
|`Success`|`bool`|آیا عملیات موفق بود؟|
|`Message`|`string`|پیام نتیجه|
|`Errors`|`List<string>`|در صورت بروز خطاها|

---

### 🧱 مدل مرتبط: `LetterArchive`

|فیلد|نوع|توضیح|
|---|---|---|
|`Id`|`Guid`|شناسه رکورد بایگانی|
|`LetterId`|`Guid`|نامه مربوطه|
|`UserId`|`Guid`|کاربر بایگانی‌کننده|
|`ArchivedAt`|`DateTime`|زمان بایگانی|

---

### 🔒 امنیت و سطح دسترسی

|سناریو|دسترسی لازم|
|---|---|
|بایگانی نامه|کاربر باید یکی از دریافت‌کنندگان یا دارای مجوز مشاهده نامه باشد|

---

### 💡 نکات تکمیلی:

- این بایگانی "شخصی" است و بر دسترسی دیگر کاربران تأثیری ندارد.
    
- حذف از بایگانی نیز باید با `UnarchiveLetter` انجام شود.
    
- اگر نامه پاک شود، بایگانی‌های مربوط به آن نیز باید Cascade حذف شوند.