
### ✅ اطلاعات پایه

|ویژگی|مقدار|
|---|---|
|🎯 نام یوزکیس|UnshareLetterWithUser|
|🧩 دامنه مرتبط|Letter, LetterPermission|
|🎯 هدف|حذف دسترسی کاربر یا کاربران مشخص از یک نامه|
|👤 استفاده‌کننده|فرستنده نامه، مالک نامه، یا هر کاربر دارای مجوز مدیریت دسترسی‌ها|
|🔐 پیش‌نیاز دسترسی|مجوز مدیریت سطح دسترسی‌ها (Admin یا Owner روی آن نامه)|

---

### 📝 توضیح کلی

این یوزکیس برای زمانی‌ست که یک نامه قبلاً با یک یا چند کاربر به اشتراک گذاشته شده و حالا نیاز است آن دسترسی لغو شود (مثلاً بعد از پایان کار، انتقال مسئولیت، یا خطای اشتراک‌گذاری).

---

### ✅ ورودی‌ها

|ورودی|نوع|توضیح|
|---|---|---|
|`LetterId`|`Guid`|شناسه نامه موردنظر|
|`UserId`|`Guid`|شناسه کاربری که درخواست لغو اشتراک را داده|
|`TargetUserId`|`Guid`|شناسه کاربری که دسترسی او باید حذف شود|

---

### 🎯 خروجی

|خروجی|نوع|توضیح|
|---|---|---|
|`Success`|`bool`|نتیجه عملیات|
|`Message`|`string`|پیام وضعیت (مثلاً «دسترسی کاربر حذف شد»)|

---

### 🧠 قوانین و شرط‌ها

- فقط کاربران مجاز (مالک نامه یا کسانی که مجوز مدیریت دارند) می‌توانند دسترسی دیگران را حذف کنند.
    
- حذف دسترسی نباید شامل خودِ مالک نامه یا کاربران با سطح دسترسی بالاتر از مجری باشد.
    
- تغییرات باید در `LetterPermission` با `IsRevoked = true` و `RevokedAt` ثبت شوند (soft delete).
    

---

### 🔧 مکانیزم پیشنهادی

- جستجوی رکورد فعال در `LetterPermission` با `LetterId` و `TargetUserId`.
    
- اگر وجود داشت → مقدار `IsRevoked = true` و ثبت زمان لغو.
    
- اگر نبود → پیام مناسب («دسترسی فعال وجود ندارد»).
    

---

### 🔗 ارتباط با سایر یوزکیس‌ها

- مکمل: `ShareLetterWithUser`
    
- مرتبط: `GetLetterPermissions`, `AuditLetterPermissionChange`