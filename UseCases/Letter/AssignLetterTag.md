
### 🎯 هدف:

کاربر بتواند برای مدیریت و دسته‌بندی بهتر، یک یا چند **تگ (برچسب)** را به نامه‌ها اختصاص دهد.

---

### ✅ سناریوهای کاربردی

|سناریو|توضیح|
|---|---|
|افزودن تگ "مهم" به یک نامه|برای شناسایی سریع‌تر در لیست|
|افزودن تگ‌های مرتبط با پروژه، موضوع یا پیگیری|تگ‌هایی مثل "پروژه الف"، "پاسخ نیاز دارد"، "مالیاتی"|
|قابلیت جستجو یا فیلتر بر اساس تگ‌های اختصاص داده‌شده|مانند Gmail و سایر اتوماسیون‌ها|

---

### 📥 ورودی‌ها (Input)

|فیلد|نوع|الزامی؟|توضیح|
|---|---|---|---|
|`LetterId`|`Guid`|✅|شناسه نامه|
|`TagId`|`Guid`|✅|شناسه تگ انتخابی|
|`UserId`|`Guid`|✅|شناسه کاربری که تگ را اضافه می‌کند|

---

### ⚙️ مراحل اجرا

1. بررسی وجود نامه و سطح دسترسی کاربر به آن
    
2. بررسی وجود تگ (و مجاز بودن کاربر برای استفاده از آن در صورت محدود بودن)
    
3. بررسی اینکه قبلاً این تگ برای این نامه ثبت نشده باشد
    
4. ثبت رکورد جدید در جدول ارتباطی `LetterTag`
    
5. بازگشت پیام موفقیت
    

---

### 📤 خروجی (Output)

|فیلد|نوع|توضیح|
|---|---|---|
|`Success`|`bool`|نتیجه عملیات|
|`Message`|`string`|پیام موفقیت یا خطا|

---

### 🗃 جدول میانی مرتبط

LetterTag {
  Id: Guid
  LetterId: Guid
  TagId: Guid
  AssignedBy: Guid
  AssignedAt: DateTime
}

### 🧩 نکات طراحی

- یک نامه می‌تواند چند تگ داشته باشد (M:N).
    
- حذف تگ نیز با یوزکیس `RemoveTagFromLetter` انجام می‌شود (قبلاً طراحی شده).
    
- در آینده می‌توان برای برخی تگ‌ها رنگ یا آیکون خاص تعریف کرد.
    
- دسترسی به تگ‌های خاص می‌تواند محدود به نقش یا واحد خاص باشد.