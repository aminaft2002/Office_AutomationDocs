
### 🎯 هدف:

امکان ویرایش محتوای یک نامه‌ی موجود تا زمانی که نهایی نشده باشد.

---

### 🧩 پیش‌نیازها:

|شرط|توضیح|
|---|---|
|نامه باید موجود باشد|شناسه نامه معتبر باشد|
|نامه نباید Finalized شده باشد|`IsFinalized == false`|
|کاربر باید دسترسی ویرایش داشته باشد|از طریق `LetterPermission` بررسی می‌شود|


### 📥 ورودی‌ها (Input)

|فیلد|نوع|الزامی؟|توضیح|
|---|---|---|---|
|`LetterId`|`Guid`|✅|شناسه یکتای نامه|
|`Subject`|`string`|⛔|موضوع جدید|
|`Body`|`string`|⛔|متن جدید نامه|
|`LetterDate`|`DateTime?`|⛔|تاریخ رسمی نامه|
|`Priority`|`enum`|⛔|اولویت نامه|
|`Confidentiality`|`enum`|⛔|محرمانگی نامه|
|`LetterType`|`enum`|⛔|نوع نامه|
|`UpdatedByUserId`|`Guid`|✅|شناسه کاربری که ویرایش را انجام می‌دهد|

---

### ⚙️ فرآیند منطقی

1. بررسی وجود نامه با `LetterId`
    
2. بررسی `IsFinalized == false`
    
3. بررسی مجوز ویرایش (`LetterPermission`)
    
4. اعمال فیلدهای جدید
    
5. به‌روزرسانی `UpdatedAt` با زمان فعلی
    
6. ثبت در `LetterLog` (اختیاری – اگر Audit فعال باشد)


### 🛡️ کنترل‌های امنیتی

- فقط کاربرانی که دارای `Edit` در `LetterPermission` هستند اجازه ویرایش دارند.
    
- اگر نامه Finalized باشد، ویرایش ممنوع است و پیام خطا بازمی‌گردد.
    

---

### 🔄 ارتباط با مدل‌ها

- `Letter`
    
- `LetterPermission`
    
- (اختیاری) `LetterLog`