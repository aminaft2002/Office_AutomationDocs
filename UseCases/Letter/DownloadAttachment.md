
### ๐ Use Case: DownloadAttachment

|ูฺฺฏ|ููุฏุงุฑ|
|---|---|
|**ูุงู ูุฒฺฉุณ**|DownloadAttachment|
|**ูุฏู**|ุงุฌุงุฒู ุฏุงุฏู ุจู ฺฉุงุฑุจุฑ ุจุฑุง ุฏุงูููุฏ ฺฉ ูุงู ูพูุณุช ุฎุงุต ุงุฒ ฺฉ ูุงูู|
|**Actor**|ฺฉุงุฑุจุฑ ุฏุงุฑุง ุฏุณุชุฑุณ ุจู ูุงูู ู ูพูุณุช ูุฑุจูุทู|
|**Trigger**|ฺฉุงุฑุจุฑ ุฑู ุฏฺฉูู ุฏุงูููุฏ ฺฉ ุงุฒ ูพูุณุชโูุง ูุงูู ฺฉูฺฉ ูโฺฉูุฏ|

---

### ๐งฉ Preconditions (ูพุดโูุงุฒูุง):

- ูพูุณุช ุจุง ุดูุงุณู ูุดุฎุต ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ.
    
- ูพูุณุช ุจู ูุงููโุง ุชุนูู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ฺฉุงุฑุจุฑ ูุฌุงุฒ ุจู ูุดุงูุฏู ุขู ุจุงุดุฏ.
    

---

### โ๏ธ Main Flow (ุฑููุฏ ุงุตู):

1. ฺฉุงุฑุจุฑ ุฏุฑุฎูุงุณุช ุฏุงูููุฏ ูุงู ูพูุณุช ูุดุฎุตโุดุฏู ุจุง `AttachmentId` ุฑุง ุงุฑุณุงู ูโฺฉูุฏ.
    
2. ุณุณุชู ุงุจุชุฏุง ูุฌูุฏ ูุงู ูพูุณุช ุฑุง ุจุฑุฑุณ ูโฺฉูุฏ.
    
3. ุณูพุณ ุจุฑุฑุณ ูโุดูุฏ ฺฉู ฺฉุงุฑุจุฑ ูุฌุงุฒ ุจู ูุดุงูุฏู ูุงููโ ูุฑุจูุทู ูุณุช ุง ุฎุฑ.
    
4. ุงฺฏุฑ ูุฌุงุฒ ุจุงุดุฏุ ฺฉ ููฺฉ ุงูู (Signed URL) ุจุฑุง ุฏุงูููุฏ ูุงู ุชููุฏ ูโุดูุฏ.
    
5. ูุงู ูพูุณุช ุฏุฑ ุงุฎุชุงุฑ ฺฉุงุฑุจุฑ ูุฑุงุฑ ูโฺฏุฑุฏ.
    

---

### ๐ Alternative Flow (ุฑููุฏ ุฌุงฺฏุฒู):

|ุดูุงุฑู|ุดุฑุท|ุฑููุฏ ุฌุงฺฏุฒู|
|---|---|---|
|A1|ูพูุณุช ุงูุช ูุดุฏ|ุฎุทุง `404 - Attachment Not Found` ููุงุด ุฏุงุฏู ูโุดูุฏ|
|A2|ฺฉุงุฑุจุฑ ูุฌุงุฒ ุจู ูุดุงูุฏู ูุงูู ูุณุช|ุฎุทุง `403 - Access Denied` ููุงุด ุฏุงุฏู ูโุดูุฏ|
|A3|ูุงู ุฑู ูุถุง ุฐุฎุฑูโุณุงุฒ ุญุฐู ุดุฏู ุง ุขุณุจโุฏุฏู ุงุณุช|ุฎุทุง `410 - File Unavailable` ุง ูพุบุงู ุฌุงฺฏุฒู ููุงุณุจ ููุงุด ุฏุงุฏู ุดูุฏ|

---

### ๐ฆ Output (ุฎุฑูุฌ):

- **ููุน ูพุงุณุฎ:** `application/octet-stream` ุง `application/pdf/image/...` ุจุฑ ุงุณุงุณ ููุน ูุงู
    
- **ูุฏุฑ Content-Disposition:** ุจุฑุง ูุงุฏุงุฑ ฺฉุฑุฏู ูุฑูุฑฺฏุฑ ุจู ุฏุงูููุฏ ูุงู ุจุง ูุงู ุงุตู
    
- **ุฏุฑ ุตูุฑุช ฺฉู ุงุฒ ุณุณุชู ุชูุฒุน ูุงู ูุงููุฏ Amazon S3 ุง Azure Blob ุงุณุชูุงุฏู ุดูุฏ:** URL ุงูุถุงุดุฏู ุจุง ุฒูุงู ุงููุถุง (e.g. 10 ุฏููู)
    

---

### ๐ก๏ธ ูฺฉุงุช ุงููุช:

- ููฺฉ ุฏุงูููุฏ ุจุงุฏ ฺฉุจุงุฑ ูุตุฑู ุง ูุญุฏูุฏ ุจู ุฒูุงู ุจุงุดุฏ.
    
- ูุณุฑ ุฐุฎุฑูโุณุงุฒ ูุงูโูุง ุจุงุฏ ุฎุงุฑุฌ ุงุฒ ูพูุดูโูุง ุนููู ูุจ ุจุงุดุฏ.
    
- ุจุฑุฑุณ ุฏูู ูุฌูุฒูุง (ACL) ุจุฑ ุงุณุงุณ ุฏุณุชุฑุณ ฺฉุงุฑุจุฑ ุจู `Letter` ู `Attachment`.
    

---

### ๐ ูุงุจุณุชฺฏโูุง:

- Entity: `LetterAttachment`
    
- Relation: `LetterAttachment โ Letter`
    
- ุจุฑุฑุณ Permission ุฑู `Letter`