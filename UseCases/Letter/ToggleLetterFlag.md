
### ✅ اطلاعات پایه

|ویژگی|مقدار|
|---|---|
|🎯 نام یوزکیس|ToggleLetterFlag|
|🧩 دامنه مرتبط|Letter|
|🎯 هدف|روشن یا خاموش کردن یک «پرچم» (Flag) برای نامه، به‌عنوان علامت پیگیری یا توجه ویژه|
|👤 استفاده‌کننده|کاربر مالک یا دریافت‌کننده نامه|
|🔐 پیش‌نیاز دسترسی|دسترسی به نامه (خواندن یا بالاتر)|

---

### 📝 توضیح کلی

پرچم‌گذاری (Flagging) یک قابلیت کمکی برای علامت‌گذاری نامه‌هایی است که کاربر می‌خواهد بعداً به آن‌ها بازگردد. این ویژگی رابط کاربری است و فقط برای خود کاربر قابل مشاهده است.

---

### ✅ ورودی‌ها

|ورودی|نوع|توضیح|
|---|---|---|
|`LetterId`|`Guid`|شناسه نامه موردنظر|
|`UserId`|`Guid`|شناسه کاربری که قصد پرچم‌گذاری دارد|

---

### 🎯 خروجی

|خروجی|نوع|توضیح|
|---|---|---|
|`Success`|`bool`|آیا عملیات موفق بود یا نه|
|`IsFlagged`|`bool`|وضعیت جدید پرچم (True = پرچم‌گذاری شد، False = حذف پرچم)|

---

### 🧠 قوانین و شرط‌ها

- این یوزکیس «حالت» را تغییر می‌دهد. اگر نامه پرچم نداشت، پرچم‌دار می‌شود؛ اگر قبلاً پرچم داشت، پرچم برداشته می‌شود.
    
- پرچم‌گذاری در سطح کاربر تعریف می‌شود (User-Specific Flag).
    
- برای نگهداری می‌توان از جدول `LetterUserSettings` استفاده کرد.
    

---

### 🔧 پیاده‌سازی پیشنهادی

csharp

CopyEdit

`// Pseudocode if (letterUserSettings.Flagged == true)     letterUserSettings.Flagged = false; else     letterUserSettings.Flagged = true;`

---

### 🧩 پایگاه داده (جدول پیشنهادی)

**LetterUserSettings**

|فیلد|نوع|توضیح|
|---|---|---|
|`UserId`|`Guid`|کاربر|
|`LetterId`|`Guid`|نامه|
|`IsFlagged`|`bool`|پرچم‌گذاری|
|`CreatedAt`|`DateTime`|تاریخ ثبت|
|`UpdatedAt`|`DateTime?`|تاریخ آخرین تغییر|

---

### 🔗 مرتبط با:

- `MarkLetterAsImportant`
    
- `PinLetterToDashboard`
    
- `SetLetterColorLabel`