

### 🎯 هدف

افزودن یا به‌روزرسانی تگ‌ها (برچسب‌ها) برای یک نامه خاص. این تگ‌ها می‌توانند برای جستجو، فیلتر و دسته‌بندی نامه‌ها استفاده شوند.

---

### 🧑‍💻 بازیگران (Actors)

- کاربر ایجادکننده نامه یا کاربران دارای دسترسی به نامه
    

---

### 🛑 پیش‌نیاز

- نامه موردنظر وجود داشته باشد
    
- کاربر دسترسی لازم برای ویرایش تگ‌ها را داشته باشد
    
- نامه نهایی نشده باشد (اختیاری، بستگی به سیاست سیستم دارد)
    

---

### ✅ نتیجه موفق

- تگ‌های نامه به‌روزرسانی می‌شوند
    
- ارتباط‌ها در جدول واسط `LetterTag` تنظیم می‌گردند
    
- لاگ با عنوان «تگ‌گذاری نامه» ثبت می‌شود
    

---

### ❌ نتیجه ناموفق

- عدم وجود نامه
    
- عدم دسترسی کاربر
    
- خطای معتبر نبودن تگ‌ها
    

---

### 📥 داده‌های ورودی

|فیلد|نوع|الزامی|توضیح|
|---|---|---|---|
|`LetterId`|`Guid`|✅|شناسه نامه|
|`TagIds`|`List<Guid>`|✅|لیست شناسه تگ‌ها|

---

### 🧠 منطق عملکرد

1. دریافت `LetterId` و `TagIds`
    
2. بررسی دسترسی کاربر به نامه
    
3. حذف تگ‌های قبلی مرتبط با نامه (اگر سیاست سیستم اجازه دهد)
    
4. ثبت مجدد تگ‌های جدید در جدول واسط `LetterTag`
    
5. ثبت در `LetterLog` با پیام "Tags Updated"
    

---

### 🔐 ملاحظات امنیتی

- فقط کاربر ایجادکننده یا مدیر با دسترسی می‌تواند این عمل را انجام دهد
    
- در صورت نهایی‌شدن نامه، امکان ویرایش تگ ممکن است بسته شود (بسته به تنظیمات)