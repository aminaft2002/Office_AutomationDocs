
### 📄 Use Case: DuplicateLetter

|ویژگی|مقدار|
|---|---|
|**نام یوزکیس**|DuplicateLetter|
|**هدف**|ایجاد یک کپی از یک نامه موجود برای استفاده مجدد (مثلاً جهت ارسال مشابه، یا الگوگیری از نامه قبلی)|
|**Actor**|کاربر دارای دسترسی به نامه اولیه|
|**Trigger**|کاربر روی گزینه "ایجاد کپی" یا "Duplicate" در صفحه جزئیات نامه کلیک می‌کند|

---

### 🧩 Preconditions (پیش‌نیازها):

- نامه‌ای با `LetterId` مشخص وجود داشته باشد.
    
- کاربر دسترسی مشاهده و ایجاد نامه جدید داشته باشد.
    

---

### ⚙️ Main Flow (روند اصلی):

1. کاربر درخواست ایجاد کپی از یک نامه خاص را ارسال می‌کند.
    
2. سیستم صحت وجود نامه اولیه را بررسی می‌کند.
    
3. محتویات نامه (شامل موضوع، متن، پیوست‌ها، تگ‌ها و سایر فیلدهای انتخاب‌شده) خوانده می‌شود.
    
4. یک نامه جدید از نوع `Draft` با اطلاعات مشابه ساخته می‌شود:
    
    - شناسه جدید
        
    - وضعیت: پیش‌نویس (`Draft`)
        
    - شماره نامه: خالی یا در انتظار تولید خودکار
        
    - تاریخ ثبت جدید
        
    - ایجادکننده = کاربر فعلی
        
    - پیوست‌ها و تگ‌ها به‌صورت اختیاری کپی شوند
        
5. شناسه نامه جدید به عنوان پاسخ بازگردانده می‌شود.
    

---

### 🔄 Alternative Flow (روند جایگزین):

|شماره|شرط|روند جایگزین|
|---|---|---|
|A1|نامه پیدا نشد|خطای `404 - Letter Not Found` نمایش داده شود|
|A2|کاربر مجاز به مشاهده یا ایجاد نامه نیست|خطای `403 - Access Denied` نمایش داده شود|

---

### 📦 Output (خروجی):

{
  "newLetterId": "uuid",
  "status": "Draft"
}

### ⚙️ گزینه‌های قابل تنظیم:

|گزینه|توضیح|
|---|---|
|`IncludeAttachments`|آیا پیوست‌ها نیز کپی شوند؟ (پیش‌فرض: false)|
|`IncludeTags`|آیا تگ‌ها نیز منتقل شوند؟ (پیش‌فرض: false)|
|`IncludeRouting`|آیا ارجاعات نیز کپی شوند؟ (پیش‌فرض: false)|
|`ResetFields`|فیلدهایی که باید ریست شوند: `LetterNumber`, `LetterDate`, `ExternalNumber`, ...|

---

### 🛡️ نکات امنیتی:

- تنها کاربران دارای سطح دسترسی مناسب به `Letter` و قابلیت ایجاد `Draft` جدید مجاز هستند.
    
- شماره نامه در حالت پیش‌نویس خالی نگه داشته می‌شود تا در زمان ارسال تولید شود.
    

---

### 📚 وابستگی‌ها:

- Entity: `Letter`
    
- Optional: `LetterAttachment`, `LetterTag`, `LetterRouting`
    
- Permission Check: `CanViewLetter`, `CanCreateLetter`