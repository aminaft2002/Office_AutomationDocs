### ๐ Use Case: UpdateLetterStatus

|ูฺฺฏ|ููุฏุงุฑ|
|---|---|
|**ูุงู ูุฒฺฉุณ**|UpdateLetterStatus|
|**ูุฏู**|ุชุบุฑ ูุถุนุช (Status) ูุงูู ุจู ฺฉ ุงุฒ ุญุงูุชโูุง ูุฌุงุฒ ุจุฑ ุงุณุงุณ ุนููุงุช ุงูุฌุงูโุดุฏู|
|**Actor**|ฺฉุงุฑุจุฑ ูุฌุงุฒ (ูุซูุงู ูุณุฆูู ุซุจุชุ ฺฏุฑูุฏูุ ูุฏุฑ ูุงุญุฏ)ุ ุง ุณุณุชู|
|**Trigger**|ุนููุงุชโูุง ูุงููุฏ ุงุฑุณุงูุ ุงุฑุฌุงุนุ ูพุงุณุฎุ ุจุณุชู ุง ุฎูุงูุฏูโุดุฏู ูุงูู ุฑุฎ ูโุฏููุฏ|

---

### ๐งฉ Preconditions (ูพุดโูุงุฒูุง):

- ฺฉุงุฑุจุฑ ุจุงุฏ ุฏุณุชุฑุณ ู ูุฌูุฒ ูุงุฒู ุจุฑุง ุงูุฌุงู ุนููุงุช ุฏุงุดุชู ุจุงุดุฏ.
    
- ูุงูู ููุฑุฏูุธุฑ ุจุงุฏ ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ.
    
- ูุถุนุช ูุนู ูุงูู ุจุงุฏ ุงุฌุงุฒูโ ุงูุชูุงู ุจู ูุถุนุช ุฌุฏุฏ ุฑุง ุจุฏูุฏ (ูุซูุงู ูุงูู ุจุณุชูโุดุฏู ูุจุงุดุฏ).
    

---

### ๐ ูุถุนุชโูุง ููฺฉู (LetterStatus Enum):
enum LetterStatus {
  Draft,
  Registered,
  Sent,
  Received,
  Read,
  Referred,
  Responded,
  Archived,
  Closed
}

### ๐ Transitions ูุฌุงุฒ:

|ูุถุนุช ูุนู|ูุถุนุช ูุฌุงุฒ ุจุนุฏ|
|---|---|
|Draft|Registered, Sent|
|Registered|Sent|
|Sent|Received, Referred, Read|
|Received|Read, Referred|
|Referred|Responded|
|Responded|Closed|
|Any|Archived|
|Archived|Unarchived|

---

### โ๏ธ Main Flow (ุฑููุฏ ุงุตู):

1. ฺฉุงุฑุจุฑ ุง ุณุณุชูุ ุฏุฑุฎูุงุณุช ุชุบุฑ ูุถุนุช ุฑุง ุจุง `LetterId` ู `NewStatus` ุงุฑุณุงู ูโฺฉูุฏ.
    
2. ุณุณุชู ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุงู ุชุบุฑ ูุถุนุช ูุฌุงุฒ ุงุณุช.
    
3. ุฏุฑ ุตูุฑุช ูุฌุงุฒ ุจูุฏู:
    
    - ูุถุนุช ุฌุฏุฏ ุฏุฑ ุฏุชุงุจุณ ุซุจุช ูโุดูุฏ.
        
    - ุฑฺฉูุฑุฏ ุฏุฑ `LetterLog` ุงุถุงูู ูโุดูุฏ.
        
    - ุฏุฑ ุตูุฑุช ูุงุฒุ ููุชูฺฉุดู ุงุฑุณุงู ูโฺฏุฑุฏุฏ.
        
4. ุฏุฑ ุตูุฑุช ูุงูุนุชุจุฑ ุจูุฏู ูุถุนุช:
    
    - ุนููุงุช ุฑุฏ ุดุฏู ู ูพุงู ุฎุทุง ุจุงุฒ ูโฺฏุฑุฏุฏ.
        

---

### ๐ Alternative Flow (ุงุณุชุซูุงุฆุงุช):

|ุดูุงุฑู|ุดุฑุท|ูุชุฌู|
|---|---|---|
|A1|ูุถุนุช ููุตุฏ ุบุฑูุฌุงุฒ ุงุณุช|ูพุงู: `InvalidStatusTransitionException`|
|A2|ฺฉุงุฑุจุฑ ูุฌูุฒ ูุฏุงุฑุฏ|ูพุงู: `PermissionDeniedException`|
|A3|ูุงูู ูุฌูุฏ ูุฏุงุฑุฏ|ูพุงู: `LetterNotFoundException`|
|A4|ูุงูู ุฏุฑ ูุถุนุช ููุง ุงุณุช (Closed)|ูพุงู: `CannotUpdateClosedLetterException`|

---

### ๐ฆ Output (ููููู ุฎุฑูุฌ ูููู):

{
  "success": true,
  "newStatus": "Referred",
  "timestamp": "2025-07-28T14:52:00Z"
}


### ๐ ูฺฉุงุช ุงููุช:

- ุงุนุชุจุงุฑุณูุฌ ููุด ฺฉุงุฑุจุฑ ุงูุฌุงู ูโุดูุฏ (ูุซูุงู ููุท ูุฑุณุชูุฏู ูโุชูุงูุฏ `Sent` ฺฉูุฏ).
    
- ุซุจุช ูุงฺฏ ุจุฑุง ูุฑ ุชุบุฑ ูุถุนุช ุงุฌุจุงุฑ ุงุณุช (`LetterLog`).
    

---

### ๐ ูุงุจุณุชฺฏโูุง:

- Entity: `Letter`, `LetterLog`
    
- Enum: `LetterStatus`
    
- Table: `LetterPermissions`
    
- ูุฒฺฉุณโูุง ูุฑุชุจุท: `SendLetter`, `ReceiveLetter`, `ArchiveLetter`, `MarkLetterAsRead`
- 