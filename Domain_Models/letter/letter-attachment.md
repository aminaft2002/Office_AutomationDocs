
# 📎 Entity: LetterAttachment (پیوست‌نامه)

## 🎯 هدف
مدل `LetterAttachment` اطلاعات مربوط به فایل‌های پیوست‌شده به نامه‌ها را ذخیره می‌کند. هر نامه می‌تواند دارای چندین پیوست باشد.

---

## 🧱 فیلدهای اصلی

| فیلد | نوع | توضیح |
|------|------|--------|
| `Id` | `Guid` | شناسه یکتا |
| `LetterId` | `Guid` | شناسه نامه مرتبط |
| `FileName` | `string` | نام فایل |
| `FileSize` | `long` | حجم فایل (بایت) |
| `MimeType` | `string` | نوع فایل (application/pdf, image/jpeg, ...) |
| `UploadDate` | `DateTime` | تاریخ بارگذاری |
| `UploadedByUserId` | `Guid` | شناسه کاربر آپلودکننده |
| `IsConfidential` | `bool` | آیا پیوست محرمانه است؟ |
| `FilePath` | `string` | مسیر فایل (در سرور یا object storage) |

| ارتباط                       | توضیح                               |
| ---------------------------- | ----------------------------------- |
| `Letter-attachment → Letter` | هر پیوست به یک نامه تعلق دارد       |
| `Letter-attachment → User`   | کاربری که فایل را بارگذاری کرده است |
|                              |                                     |

|رابطه|نوع ارتباط|توضیح|
|---|---|---|
|`LetterAttachment → Letter`|Many-to-One|فایل به کدام نامه متصل است|
|`LetterAttachment → UploadedBy`|Many-to-One|کاربری که فایل را بارگذاری کرده|
|`LetterAttachment → FileStorage`|Many-to-One|اشاره به فایل ذخیره‌شده در سیستم فایل (مسیر/لینک)|
|`LetterAttachment → AttachmentType`|Enum|نوع پیوست (تصویر، PDF، نامه رسمی، اسکن امضا و...)|


## 🧩 وابستگی‌های اصلی

- `Letter` ← برای `LetterId`
    
- `User` ← برای `UploadedById`
    
- `FileStorage` یا ساختار مدیریت فایل داخلی ← برای نگهداری آدرس فایل
    
- `AttachmentType` ← تعریف نوع پیوست
    

---

## 🧠 نکات مهم طراحی

- اگر بخوایم امنیت بیشتری در نمایش فایل‌ها داشته باشیم، بهتره آدرس فایل مستقیم نباشه و به‌صورت توکن‌دار یا لینک موقت مدیریت بشه.
    
- میشه برای هر پیوست **فیلد `IsMain`** تعریف کرد (برای پیوست اصلی مثل نسخه نهایی PDF نامه).
    
- فیلد `DisplayOrder` می‌تونه ترتیب نمایش پیوست‌ها رو کنترل کنه.
---

## 📌 نکات طراحی

- فایل‌ها در دیتابیس ذخیره نمی‌شوند، بلکه فقط مسیرشان نگه‌داری می‌شود.
- در آینده می‌توان از Azure Blob، Amazon S3 یا MinIO برای ذخیره فایل استفاده کرد.
- در نامه‌های محرمانه، فقط کاربران مجاز می‌توانند فایل را مشاهده یا دانلود کنند.

---

## 🔒 امنیت پیوست‌ها

پیوست‌ها بخشی از حریم اطلاعاتی هستند:
- باید سطح دسترسی به آن‌ها همانند نامه رعایت شود
- حذف و نسخه‌گذاری فایل در آینده مهم خواهد بود (Versioning)
